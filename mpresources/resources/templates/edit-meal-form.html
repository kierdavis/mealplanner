{{/*
    edit-meal-form.html contains the form used for adding and editing meals.
    
    Dot is expected to be of type mpdata.MealWithTags. If empty, the "add meal"
    form is displayed, else the "edit meal" form is displayed.
*/}}

<!DOCTYPE html>
<html lang="en">
    <head>
        {{if .}}
            <title>Edit Meal :: Meal Planner</title>
        {{else}}
            <title>Create Meal :: Meal Planner</title>
        {{end}}
        
        {{template "common-head.html"}}
        
        <script type="text/javascript">
            $(document).ready(function() {
                // Bind event handlers
                
                // Select all tags on form submission
                $("#form").submit(function() {
                    $("#tags option").attr("selected", "selected");
                });
                
                // Implement fetching all tags in database when drop-down is
                // opened.
                $("#existing-tag").click(function(event) {
                    if (!MPAjax.tagsFetched) {
                        MPAjax.fetchAllTags(this);
                    }
                });
                
                // Implement adding existing tags
                $("#add-existing-tag").click(function(event) {
                    event.preventDefault();
                    
                    var tag = $("#existing-tag").val();
                    $("<option>").val(tag).text(tag).appendTo($("#tags"));
                });
                
                // Implement adding new tags
                $("#add-new-tag").click(function(event) {
                    event.preventDefault();
                    
                    var tag = $("#new-tag").val();
                    $("#new-tag").val("");
                    $("<option>").val(tag).text(tag).appendTo($("#tags"));
                });
                
                // Implement tag removal
                $("#remove-tag").click(function(event) {
                    event.preventDefault();
                    
                    $("#tags option:selected").remove();
                });
                
                // Implement resetting the tags list on reset
                $("#reset").click(function() {
                    var tagsList = $("#tags").empty();
                    
                    {{range .Tags}}
                        $("<option>").val("{{. | js}}").text("{{. | js}}").appendTo(tagsList);
                    {{end}}
                });
            });
        </script>
    </head>
    
    <body>
        <div class="container">
            {{if .}}
                <h1>Edit meal: {{.Meal.Name}}</h1>
            {{else}}
                <h1>Create meal</h1>
            {{end}}
            
            <form action="" method="post" id="form">
                <div style="margin-bottom: 40px">
                    <table>
                        <tr>
                            <td>
                                <label for="name">Name of meal:</label>
                            </td>
                            <td>
                                <input type="text" name="name" id="name" size="50" value="{{.Meal.Name}}"/>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="recipe">Link to recipe (optional):</label>
                            </td>
                            <td>
                                <input type="text" name="recipe" id="recipe" size="80" value="{{.Meal.RecipeURL}}"/>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="favourite">Favourite:</label>
                            </td>
                            <td>
                                <input type="checkbox" name="favourite" id="favourite" value="yes" {{if .Meal.Favourite}}checked="checked"{{end}} />
                            </td>
                        </tr>
                    </table>
                </div>
                
                <div style="margin-bottom: 40px">
                    <fieldset>
                        <legend>Tags</legend>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <select name="tags" id="tags" size="6" multiple="multiple" style="min-width: 200px">
                                    {{range .Tags}}
                                        <option value="{{.}}">{{.}}</option>
                                    {{end}}
                                </select>
                            </div>
                            
                            <div class="col-md-8">
                                <table>
                                    <tr>
                                        <td>
                                            Add an existing tag:
                                        </td>
                                        <td>
                                            <select id="existing-tag" style="min-width: 100px"></select>
                                        </td>
                                        <td>
                                            <button id="add-existing-tag">Add</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            or add a new tag:
                                        </td>
                                        <td>
                                            <input type="text" id="new-tag" size="15"/>
                                        </td>
                                        <td>
                                            <button id="add-new-tag">Add</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="3">
                                            <button id="remove-tag">Remove selected tag</button>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </fieldset>
                </div>
                
                <p>
                    <input id="reset" type="reset" value="Reset"/>
                    <input type="submit" value="Save"/>
                </p>
            </form>
        </div>
    </body>
</html>
