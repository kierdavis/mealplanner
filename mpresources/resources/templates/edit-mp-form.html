{{/*
    edit-mp-form.html contains the form used for editing meal plans.
    
    Dot is expected to be of type *mpdata.MealPlan.
*/}}

<!DOCTYPE html>
<html>
    <head>
        <title>Edit Meal Plan :: Meal Planner</title>
        
        {{template "common-head.html"}}
        
        <script type="text/javascript">
            function f(result) {
                alert(result.meal.name);
            }
        
            function openDialog(servingDate) {
                MPAjax.fetchMealList(function(meals) {
                    MPUtil.renderMealList(meals, $("#meal-list"), f);
                    $("#dialog").dialog("open");
                });
            }
            
            $(document).ready(function() {
                $("#dialog").dialog({
                    autoOpen: false,
                    draggable: true,
                    modal: true,
                    resizable: true,
                });
                
                MPAjax.fetchServings({{.ID}}, function(results) {
                    results = results || [];
                    
                    var container = $("#servings");
                    
                    var i, result, row;
                    for (i = 0; i < results.length; i++) {
                        result = results[i];
                        
                        row = $("<tr>").appendTo(container);
                        
                        $("<td>")
                            .text(result.date)
                            .appendTo(row);
                        
                        $("<td>")
                            .text(result.hasmeal ? result.mealname : "(click to add meal)")
                            .appendTo(row)
                            .click(function(event) {
                                event.preventDefault();
                                openDialog(result.date);
                            });
                    }
                });
            });
        </script>
    </head>
    
    <body>
        <div class="container">
            <div class="page-header">
                <div class="row">
                    <div class="col-md-8">
                        <ul class="navigation">
                            <li class="home"><a href="/">Home</a></li>
                            <li><a href="/mealplans">Meal plans</a></li>
                            <li><a href="/mealplans/{{.ID}}">{{.StartDate.Format "02 Jan"}} - {{.EndDate.Format "02 Jan"}}</a></li>
                            <li>Edit</li>
                        </ul>
                    </div>
                </div>
                
                <h1>Edit Meal Plan</h1>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Serving</th>
                    </tr>
                </thead>
                <tbody id="servings"></tbody>
            </table>
        </div>
        
        <div id="dialog">
            <div id="meal-list"></div>
        </div>
    </body>
</html>
